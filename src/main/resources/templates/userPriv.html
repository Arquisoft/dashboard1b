<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>Popularidad de las sugerencias</title>
<script type="text/javascript">
	var connect = function() {
		var source = new EventSource('/userPriv/updates');
		 // Handle correct opening of connection
        source.addEventListener('open', function (e) {
            console.log('Connected.');
        });
		 
		
		
		// Reconnect if the connection fails
		source.addEventListener('error', function(e) {
			console.log('Disconnected.');
			if (e.readyState == EventSource.CLOSED) {
				connected = false;
				connect();
			}
		}, false);
	};
	
	var source = new EventSource('/userPriv/updates');
	
	 source.addEventListener('newSugerence', function(event){
		 var sugerence = JSON.parse(event.data);
		 var row = document.getElementById("table").insertRow(-1);
		 row.insertCell(0).innerHTML = "<td>" + sugerence.title + "</td>";
		 row.insertCell(1).innerHTML = "<td>" + 0 + "</td>";
		 row.insertCell(2).innerHTML = "<td>" + 0 + "</td>";
	 });
	 
<!--	 source.addEventListener('newComentary', function(event){
		 var comentary = JSON.parse(event.data);
		 var rows = document.getElementById("table").rows;
		 for(i=0; i < rows.length; i++){
			 if(rows[i].cells[0].textContent == comentary.title){
				 rows[i].cells[1].outerHTML = "<td>" + comentary.votos "</td>"";
				 break;
			 }
		 }
	 }); -->
	 
</script>
</head>

<body>
	<h1>Popularidad de las sugerencias</h1>
	<table id="table" border="1">
		<tr>
			<th>Nombre</th>
			<th>Comentarios</th>
			<th>Apoyos</th>
		</tr>
		<tr th:each="est : ${estadisticas}">
			<td th:text="${est.titulo}">Onions</td>
			<td th:text="${est.campos.get('Comentarios')}">2.41</td>
			<td th:text="${est.campos.get('Apoyos')}">2.41</td>
		</tr>
	</table>

</body>
</html>